#!/usr/bin/env node

;(function(command, undefined) {

    var __version = '0.1.2';

    var $$util = require('util');

    var $$fs = require('fs');

    var $$extfs = require('extfs');

    var $$ncp = require('ncp').ncp;

    // usage()
    // display usage on stderr
    var usage = (function() {
        $$util.error("hangover [project]");
        $$util.error("[project] is the path where hangover will initialise your project");
    });

    var cmd = {
        // cmd.version()
        // show hangover version number
        version: function() {
            $$util.puts("hangover version " + __version);
            process.exit();
        }
    } 

    if (command === undefined) {
        usage();
        process.exit(0);
    }

    if (command.substr(0, 2) == '--') {
        command = command.substr(2);
        if (cmd[command] && typeof cmd[command] === 'function') {
            cmd[command]();
        } else {
            $$util.error("Undefined command");
            usage();
        }
    }

    var path = command,
        project = path.split('/')[path.split('/').length-1];

    if ($$fs.existsSync(path)) {
        if ($$extfs.isEmptySync(path) === false) {
            $$util.error("The destination path must be an empty directory");
            process.exit(0);
        }
    }

    if (! $$fs.existsSync(__dirname + '/package/')) {
        $$util.error("Hangover seems to be broken...");
        process.exit(0);
    }

    $$ncp(__dirname + '/package/', path, function(err) {
        if (err) {
            throw new Error(err);
            return console.error(err);
        }
        $$util.puts("Your project is successfully installed in " + path);
        $$util.puts("Go to " + path + " and run a npm install");
        $$util.puts("And then... start your server via node ./server.js");
    });

})(process.argv.splice(2)[0])